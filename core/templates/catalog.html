{% extends "base.html" %}
{% block title %}Equipment Catalog{% endblock %}

{% block content %}
<div class="container-fluid">
  <div class="row">

    <!-- Left: Filters and Item Grid -->
    <div class="col-md-9 pe-4">

      <!-- Top Filter/Search Bar -->
      <form method="get" class="mb-4 d-flex gap-3">
        <input type="text" name="q" class="form-control" placeholder="Search by name..." value="{{ request.GET.q }}">

        <select name="location" class="form-select" onchange="this.form.submit()">
          <option value="">All Gyms</option>
          {% for loc in gyms %}
            <option value="{{ loc }}" {% if request.GET.location == loc %}selected{% endif %}>{{ loc }}</option>
          {% endfor %}
        </select>

        <select name="sport" class="form-select" onchange="this.form.submit()">
          <option value="">All Sports</option>
          {% for sport in sports %}
            <option value="{{ sport }}" {% if request.GET.sport == sport %}selected{% endif %}>{{ sport }}</option>
          {% endfor %}
        </select>

        <button type="submit" class="btn btn-primary">Filter</button>
      </form>

      <!-- Grid of Items -->
      <div class="row row-cols-1 row-cols-md-3 g-4">
        {% for item in items %}
        <div class="col">
          <div class="card h-100">
            {% if item.images.first %}
              <img src="{{ item.images.first.image.url }}" class="card-img-top" alt="{{ item.name }}">
            {% else %}
              <div class="card-img-top bg-secondary text-white text-center p-5">No Image</div>
            {% endif %}
            <div class="card-body">
              <h5 class="card-title">{{ item.name }}</h5>
              <button class="btn btn-outline-primary" onclick="loadSidebar({{ item.id }})">More Details</button>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Right: Sidebar -->
    <div class="col-md-3 ps-4 border-start" id="sidebar" style="min-height: 100vh;">
      <h4>Details</h4>
      <div id="sidebar-content">
        <p>Select an item to view details.</p>
      </div>
    </div>

  </div>
</div>

<!-- JS to Load Sidebar Content -->
<script>
function loadSidebar(itemId) {
  fetch(`/equipment/details/${itemId}/`)
    .then(response => response.text())
    .then(html => {
      document.getElementById("sidebar-content").innerHTML = html;
    });
}
</script>

<!-- Back to Home -->
<div class="mt-4">
  <a href="{% url 'core:home' %}" class="btn btn-primary btn-lg">Back to Home</a>
</div>

{% endblock %}