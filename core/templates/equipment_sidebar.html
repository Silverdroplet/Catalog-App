<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<h5>{{ item.name }}</h5>
<p><strong>Identifier:</strong> {{ item.identifier }}</p>
<p>{{ item.description|default:"No description available." }}</p>
<p><strong>Location:</strong> {{ item.location }}</p>
<p><strong>Sport:</strong> {{ item.sports_type|default:"N/A" }}</p>
<p><strong>Status:</strong> {{ item.get_status_display }}</p>
<p><strong>Available:</strong> {{ item.is_available|yesno:"✅ Yes,❌ No" }}</p>

<h6 class="mt-3">Reviews</h6>
{% for review in reviews %}
  <p><strong>{{ review.user.username }}</strong> rated it {{ review.rating }}/5</p>
  <p>{{ review.comment }}</p>
  <hr>
{% empty %}
  <p>No reviews yet.</p>
{% endfor %}

<!-- Borrow Button -->
{% if request.user.is_authenticated %}
  {% if item.is_available %}
    <form method="POST" action="{% url 'core:borrow_item' item.id %}">
      {% csrf_token %}
      <button type="submit" class="btn btn-success">Borrow Item</button>
    </form>
  {% else %}
    <button class="btn btn-secondary" disabled>Not Available</button>
  {% endif %}
{% endif %}

<button type="button" class="btn btn-primary mt-3" data-toggle="modal" data-target="#addToCollectionModal">
  Add to a Collection
</button>


<div class="modal fade" id="addToCollectionModal" role="dialog" tabindex="-1" aria-labelledby="addToCollectionModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form method="POST" action="{% url 'core:add_item_to_collection' item.id %}">
      {% csrf_token %}
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addToCollectionModalLabel">Add {{ item.name }} to a Collection</h5>
          <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="collectionSelect" class="form-label">Select Collection</label>
            <select class="form-select" id="collectionSelect" name="collection_id" required>
              {% for collection in collections %}
                {% if collection.visibility == 'public' or request.user in collection.allowed_users.all %}
                  <option value="{{ collection.id }}">{{ collection.title }}</option>
                {% endif %}
              {% endfor %}
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Add</button>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- Librarian Actions -->
{% if request.user.is_authenticated and request.user.profile.is_librarian %}
  <div class="mt-3">
    <a href="{% url 'core:edit_equipment' item.id %}" class="btn btn-warning me-2">Edit</a>
    <a href="{% url 'core:delete_equipment' item.id %}" class="btn btn-danger">Delete</a>
  </div>
{% endif %}