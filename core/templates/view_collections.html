{% extends 'base.html' %}

{% if messages %}
    <ul class="messages">
        {% for message in messages %}
            <li class="{{ message.tags }}">{{ message }}</li>
        {% endfor %}
    </ul>
{% endif %}

{% block content %}
    {% if modification_logs %}
    <h3>Changes to Your Collections:</h3>
    <ul>
        {% for key, logs in modification_logs.items %}
        <ul>
            {% for log in logs %}
                <li>{{ log }}</li>
            {% endfor %}
        </ul>
    {% endfor %}
    </ul>
    {% else %}
    {% endif %}

    <h2>My Collections</h2>
    <ul>
        {% for collection in collections %}
    <li>
        <h2>{{ collection.title }}</h2> 
        Description:  {{ collection.description }}

        <h3>Collection items:</h3>
        {% if collection.items.all %}
            <ul>
                {% for item in collection.items.all %}
                    <li>
                        <strong>{{ item.name }}</strong> ({{ item.status }})
                        <br>
                        <small>ID: {{ item.identifier }}</small>
                        <br>
                        <small>Description: {{ item.description }}</small>
                        <br>
                        <small>Location: {{ item.location }}</small>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No items in this collection.</p>
        {% endif %}

        {% if collection.access_requests.all %}
            <h3>Access Requests:</h3>
            <ul>
                {% for user in collection.access_requests.all %}
                    <li>
                        {{ user.username }}
                        <form method="post" action="{% url 'core:approve_access' collection.id user.id %}">
                            {% csrf_token %}
                            <button type="submit">Approve</button>
                        </form>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No access requests.</p>
        {% endif %}
        {% if user.profile.is_librarian or collection.creator == request.user %}
        <a href="{% url 'core:edit_collection' collection.id %}">Edit This Collection</a>
        {% endif %}
        <br>
        <a href="{% url 'core:view_collection' collection.id %}">View Details!</a>
        <br>
        <form method="POST" action="{% url 'core:delete_collection' collection.id %}" style="display: inline;">
            {% csrf_token %}
            <button type="submit" onclick="return confirm('Are you sure you want to delete this collection?')" 
                    class="btn btn-danger">Delete</button>
        </form>
    </li>
{% endfor %}
    </ul>
{% endblock %}